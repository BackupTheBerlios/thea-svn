<?xml version="1.0" encoding="UTF-8"?>
<project basedir="." default="compile" name="thea">

  <!-- set global properties for this build -->
  <property name="src.dir" value="src"/>
  <property name="test.dir" value="test"/>
  <property name="lib.dir" value="lib"/>
  <property name="generated.dir" value="build"/>
  <property name="conf.dir" value="conf"/>
  <property name="classes.dir" value="${generated.dir}/classes"/>
  <property name="reports.dir" value="${generated.dir}/reports"/>

  <path id="java.class.path">
    <fileset dir="${lib.dir}">
      <include name="**/*.jar"/>
    </fileset>
    <dirset dir="${classes.dir}"/>
    <dirset dir="${src.dir}"/>
    <dirset dir="${conf.dir}"/>
  </path>

  <target description="Clean all generated files and directories." name="clean">
    <defaultexcludes remove="**/*~"/>
    <delete>
      <fileset dir="." includes="**/*~"/>
    </delete>
    <delete dir="${generated.dir}"/>
  </target>


  <target name="compile">
    <mkdir dir="${classes.dir}"/>
    <javac classpathref="java.class.path" debug="true" deprecation="true" destdir="${classes.dir}" srcdir="${src.dir}">
    </javac>
    <javac classpathref="java.class.path" debug="true" deprecation="true" destdir="${classes.dir}" srcdir="${test.dir}"/>
  </target>

  <target name="schemaexport" depends="compile" >
    <taskdef classname="net.sf.hibernate.tool.hbm2ddl.SchemaExportTask" classpathref="java.class.path" name="schemaexport"/>
    <schemaexport delimiter=";" drop="no" output="${generated.dir}/database-schema.sql" properties="${conf.dir}/hibernate.properties" quiet="yes" text="no">
      <fileset dir="${src.dir}">
        <include name="**/*.hbm.xml"/>
      </fileset>
    </schemaexport>
  </target>

  <target name="test" depends="compile, schemaexport">
    <mkdir dir="${reports.dir}"/>
    <!-- PERSISTENT TESTS -->
    <junit printsummary="yes" haltonfailure="yes" fork="yes">
      <jvmarg value="-Dfr.unice.bioinfo.allonto.datamodel.ResourceFactory=fr.unice.bioinfo.allonto.persistence.PersistentResourceFactory"/>
      <classpath>
        <path refid="java.class.path"/>
        <pathelement path="${test.dir}"/>
      </classpath>
      <formatter type="plain"/>
      <batchtest todir="${reports.dir}">
        <fileset dir="${test.dir}">
          <include name="**/Test*.java"/>
        </fileset>
      </batchtest>
    </junit>
  </target>

  <target name="jar" depends="compile">
    <jar basedir="${classes.dir}" jarfile="${generated.dir}/thea-persistence.jar">
      <fileset dir="${classes.dir}"/>
    </jar>
  </target>
</project>
