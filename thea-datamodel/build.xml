<?xml version="1.0" encoding="UTF-8"?>
<project basedir="." default="compile" name="thea">

  <!-- set global properties for this build -->
  <property name="src.dir" value="src"/>
  <property name="test.dir" value="test"/>
  <property name="lib.dir" value="lib"/>
  <property name="conf.dir" value="conf"/>
  <property name="generated.dir" value="build"/>
  <property name="classes.dir" value="${generated.dir}/classes"/>
  <property name="reports.dir" value="${generated.dir}/reports"/>

  <path id="java.class.path">
    <fileset dir="${lib.dir}">
      <include name="**/*.jar"/>
    </fileset>
    <dirset dir="${classes.dir}"/>
    <dirset dir="${src.dir}"/>
    <dirset dir="${conf.dir}"/>
  </path>

  <target description="Clean all generated files and directories." name="clean">
    <defaultexcludes remove="**/*~"/>
    <delete>
      <fileset dir="." includes="**/*~"/>
    </delete>
    <delete dir="${generated.dir}"/>
  </target>

  <target name="compile">
    <mkdir dir="${classes.dir}"/>
    <javac classpathref="java.class.path" debug="true" deprecation="true" destdir="${classes.dir}" srcdir="${src.dir}">
    </javac>
    <javac classpathref="java.class.path" debug="true" deprecation="true" destdir="${classes.dir}" srcdir="${test.dir}"/>
  </target>

  <target name="test" depends="compile">
    <mkdir dir="${reports.dir}"/>
    <junit printsummary="yes" haltonfailure="yes" fork="yes">
    <!-- IN MEMORY TESTS -->
      <jvmarg value="-Dfr.unice.bioinfo.allonto.datamodel.ResourceFactory=fr.unice.bioinfo.allonto.datamodel.DefaultResourceFactory"/>
      <classpath>
        <path refid="java.class.path"/>
        <pathelement path="${test.dir}"/>
      </classpath>
      <formatter type="plain"/>
      <batchtest todir="${reports.dir}">
        <fileset dir="${test.dir}">
          <include name="**/Test*.java"/>
        </fileset>
      </batchtest>
    </junit>
  </target>
  <target name="jar" depends="compile">
    <jar basedir="${classes.dir}" jarfile="${generated.dir}/thea-datamodel.jar">
      <fileset dir="${classes.dir}"/>
    </jar>
  </target>
</project>
